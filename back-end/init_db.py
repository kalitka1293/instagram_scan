from sqlalchemy.orm import Session
from database import engine, Base, SessionLocal
from models import Tariff
import json


def create_tables():
    """–°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü...")
    Base.metadata.create_all(bind=engine)
    print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")


def init_tariffs(db: Session):
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞—Ä–∏—Ñ—ã
    existing_tariffs = db.query(Tariff).count()
    if existing_tariffs > 0:
        print(f"‚ö†Ô∏è  –¢–∞—Ä–∏—Ñ—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç ({existing_tariffs} —à—Ç.), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é")
        return
    
    tariffs_data = [
        {
            "name": "–î–µ–º–æ",
            "price": 19.0,
            "duration_days": 2,
            "subtitle": "–•–æ—á–µ—à—å –∑–∞–≥–ª—è–Ω—É—Ç—å –∑–∞ –∫—É–ª–∏—Å—ã? –ù–∞—á–Ω–∏ —Å –¥–µ–º–æ ‚Äî –≤—Å–µ–≥–æ 19‚ÇΩ –∑–∞ 2 –¥–Ω—è!",
            "features": [
                "–í—Å—ë —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∑–∞ –∫–æ–ø–µ–π–∫–∏ ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É",
                "–ö—Ç–æ –≤ —Ç–µ–Ω–∏? ‚Äî —Ä–∞—Å–∫—Ä–æ–π —Å–∫—Ä—ã—Ç—ã—Ö –ø–æ–∫–ª–æ–Ω–Ω–∏–∫–æ–≤ –∏ —Ç–∞–π–Ω—ã–µ —Å–≤—è–∑–∏",
                "–ë—ã—Å—Ç—Ä–æ, –¥—ë—à–µ–≤–æ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ—á–Ω–æ!"
            ],
            "is_demo": True,
            "auto_renewal": True,
            "next_tariff_price": 999.0
        },
        {
            "name": "–≠–∫–æ",
            "price": 249.0,
            "duration_days": 2,
            "subtitle": "2 –¥–Ω—è –º–æ—â–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –æ–±–µ–¥ –≤ –∫–∞—Ñ–µ!",
            "features": [
                "–õ–∞–π–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äì –£–≤–∏–¥–∏—à—å, –∫—Ç–æ –∞–∫—Ç–∏–≤–Ω–µ–µ –≤—Å–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç",
                "–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ ‚Äì –í—Å—è –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ 2 –¥–Ω—è",
                "–°–∫—Ä—ã—Ç—ã–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–∏ ‚Äì –ö—Ç–æ —Å–ª–µ–¥–∏—Ç –∑–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–º, –Ω–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞—è—Å—å"
            ]
        },
        {
            "name": "–°—É—Ç–æ—á–Ω—ã–π",
            "price": 499.0,
            "duration_days": 1,
            "subtitle": "24 —á–∞—Å–∞ ‚Äî –∏ —Ç—ã –∑–Ω–∞–µ—à—å –í–°–Å.",
            "features": [
                "–ú–∞–∫—Å–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö –∑–∞ 1 –¥–µ–Ω—å! ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: –ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ–¥–ø–∏—Å–∫–∏",
                "–ü–æ–¥–ø–∏—Å–Ω–æ–π —Ä–µ–π—Ç–∏–Ω–≥ - –ê–Ω–∞–ª–∏–∑ —Å–∞–º—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫",
                "–¢–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã ‚Äî –±–µ–∑ –≤–æ–¥—ã ‚Äî –≤—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ"
            ]
        },
        {
            "name": "–≠–∫—Å–∫–ª—é–∑–∏–≤",
            "price": 999.0,
            "duration_days": 10,
            "subtitle": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ 10 –¥–Ω–µ–π!",
            "features": [
                "–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü–∏–µ–π ‚Äî 10 –¥–Ω–µ–π –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º",
                "–†–∞—Å–∫—Ä–æ–π, —Å –∫–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–∫—Ä—ã—Ç–Ω–æ",
                "–¢–≤–æ–π –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ü–µ–ª–∏ –¥–µ–Ω—å –∑–∞ –¥–Ω—ë–º"
            ],
            "auto_renewal": True
        },
        {
            "name": "–§—É–ª–ª",
            "price": 349.0,
            "duration_days": 4,
            "subtitle": "–í—Å—ë, —á—Ç–æ —Å–∫—Ä—ã—Ç–æ - —Ç–µ–ø–µ—Ä—å –≤ —Ç–≤–æ–∏—Ö —Ä—É–∫–∞—Ö",
            "features": [
                "–ì–∏–±–∫–∏–π —Å—Ä–æ–∫ ‚Äì –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Ü–µ–Ω—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç—É–ø–∞",
                "–í—Å—ë, —á—Ç–æ —Å–∫—Ä—ã—Ç–æ ‚Äî –ø–æ–¥–ø–∏—Å–∫–∏, –ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî –ø–æ–ª–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥",
                "–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ ‚Äî 4 –¥–Ω—è ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –≤—Å—ë –Ω–∞–π—Ç–∏"
            ]
        },
        {
            "name": "–ö–æ–º–±–æ 5",
            "price": 699.0,
            "requests_count": 5,
            "subtitle": "5 —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
            "features": [
                "5 —Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äì –ü–æ–ª—É—á–∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
                "–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äì –û–ø–ª–∞—Ç–∏ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ —É–≥–æ–¥–Ω–æ",
                "–õ—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äì –õ–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äì —á—Ç–æ —É–≥–æ–¥–Ω–æ –∑–∞ —Ä–∞–∑"
            ]
        },
        {
            "name": "–ö–æ–º–±–æ 10",
            "price": 1099.0,
            "requests_count": 10,
            "subtitle": "10 –∑–∞–ø—Ä–æ—Å–æ–≤ = –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —è—Å–Ω–æ—Å—Ç—å. –ë–µ—Ä–∏ –∏ —É–∑–Ω–∞–≤–∞–π –í–°–Å!",
            "features": [
                "–í 2 —Ä–∞–∑–∞ –º–æ—â–Ω–µ–µ! ‚Äî 10 –∑–∞–ø—Ä–æ—Å–æ–≤ = –ø–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ",
                "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ú–∞–∫—Å–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö –∑–∞ –º–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤",
                "–≠–∫–æ–Ω–æ–º–∏—è 300‚ÇΩ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º –æ–±—ä—ë–º–µ!"
            ]
        }
    ]
    
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤...")
    for tariff_data in tariffs_data:
        tariff = Tariff(**tariff_data)
        db.add(tariff)
    
    db.commit()
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ {len(tariffs_data)} —Ç–∞—Ä–∏—Ñ–æ–≤!")


def init_database():
    """–ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã
    create_tables()
    
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
    db = SessionLocal()
    
    try:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã
        init_tariffs(db)
        
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        db.rollback()
        
    finally:
        db.close()


if __name__ == "__main__":
    init_database()